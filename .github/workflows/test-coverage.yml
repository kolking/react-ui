name: Test coverage
on: 
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write

    steps:
    - uses: actions/checkout@v5
    - name: Install Node.js
      uses: actions/setup-node@v6
      with:
        node-version: '20.x'
    - name: Install deps
      run: yarn
    - name: Run tests
      run: yarn validate-ci
    - name: Report coverage
      if: always() 
      uses:  davelosert/vitest-coverage-report-action@v2
      with:
        file-coverage-mode: changes-affected
        threshold-icons: "{0: 'ğŸ”´', 70: 'ğŸŸ ', 90: 'ğŸŸ¢'}"